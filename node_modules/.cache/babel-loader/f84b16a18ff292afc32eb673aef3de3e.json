{"ast":null,"code":"import _regeneratorRuntime from\"/Users/manuelpolaina/Documents/CURSOS/JUANP/React/MERNtasks/cliente/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/manuelpolaina/Documents/CURSOS/JUANP/React/MERNtasks/cliente/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/manuelpolaina/Documents/CURSOS/JUANP/React/MERNtasks/cliente/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useReducer}from'react';import authContext from'./authContext';import authReducer from'./authReducer';import clienteAxios from'../../config/axios';import tokenAuth from'../../config/token';// eslint-disable-next-line\nimport{REGISTRO_EXITOSO,REGISTRO_ERROR,OBTENER_USUARIO,LOGIN_EXITOSO,LOGIN_ERROR,CERRAR_SESION}from'../../types';var AuthState=function AuthState(props){var initialState={token:localStorage.getItem('token'),autenticado:null,usuario:null,mensaje:null,cargando:true};var _useReducer=useReducer(authReducer,initialState),_useReducer2=_slicedToArray(_useReducer,2),state=_useReducer2[0],dispatch=_useReducer2[1];// FUNCIONES\n// REGISTRO de usuario\nvar registrarUsuario=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(datos){var respuesta,alerta;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return clienteAxios.post('/api/usuarios',datos);case 3:respuesta=_context.sent;console.log(respuesta.data);dispatch({type:REGISTRO_EXITOSO,payload:respuesta.data});// al registrarse OBTENERMOS EL USUARIO\nobtenerUsuario();_context.next=13;break;case 9:_context.prev=9;_context.t0=_context[\"catch\"](0);//console.log(error.response.data.msg)\nalerta={msg:_context.t0.response.data.msg,categoria:'alerta-error'};dispatch({type:REGISTRO_ERROR,payload:alerta});case 13:case\"end\":return _context.stop();}}},_callee,null,[[0,9]]);}));return function registrarUsuario(_x){return _ref.apply(this,arguments);};}();// OBTENER USUARIO autenticado\nvar obtenerUsuario=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var token,respuesta;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:// obtenemos el token del localStorage colocado por REGISTRO_EXITOSO\ntoken=localStorage.getItem('token');if(token){tokenAuth(token);}_context2.prev=2;_context2.next=5;return clienteAxios.get('/api/auth');case 5:respuesta=_context2.sent;//console.log(respuesta.data)\ndispatch({type:OBTENER_USUARIO,payload:respuesta.data.usuario});_context2.next=13;break;case 9:_context2.prev=9;_context2.t0=_context2[\"catch\"](2);console.log(_context2.t0.response);dispatch({type:LOGIN_ERROR});case 13:case\"end\":return _context2.stop();}}},_callee2,null,[[2,9]]);}));return function obtenerUsuario(){return _ref2.apply(this,arguments);};}();// INICIO DE SESIÓN\nvar iniciarSesion=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(datos){var respuesta,alerta;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return clienteAxios.post('/api/auth',datos);case 3:respuesta=_context3.sent;//console.log(respuesta)\ndispatch({type:LOGIN_EXITOSO,payload:respuesta.data// pasa el token \n});// al iniciar sesión OBTENERMOS EL USUARIO\nobtenerUsuario();_context3.next=13;break;case 8:_context3.prev=8;_context3.t0=_context3[\"catch\"](0);console.log(_context3.t0.response.data.msg);alerta={msg:_context3.t0.response.data.msg,categoria:'alerta-error'};dispatch({type:LOGIN_ERROR,payload:alerta});case 13:case\"end\":return _context3.stop();}}},_callee3,null,[[0,8]]);}));return function iniciarSesion(_x2){return _ref3.apply(this,arguments);};}();// CERRAR SESIÓN\nvar cerrarSesion=function cerrarSesion(){dispatch({type:CERRAR_SESION});};return/*#__PURE__*/React.createElement(authContext.Provider,{value:{token:state.token,autenticado:state.autenticado,usuario:state.usuario,mensaje:state.mensaje,cargando:state.cargando,registrarUsuario:registrarUsuario,iniciarSesion:iniciarSesion,obtenerUsuario:obtenerUsuario,cerrarSesion:cerrarSesion}},props.children);};export default AuthState;","map":{"version":3,"sources":["/Users/manuelpolaina/Documents/CURSOS/JUANP/React/MERNtasks/cliente/src/context/autenticacion/authState.js"],"names":["React","useReducer","authContext","authReducer","clienteAxios","tokenAuth","REGISTRO_EXITOSO","REGISTRO_ERROR","OBTENER_USUARIO","LOGIN_EXITOSO","LOGIN_ERROR","CERRAR_SESION","AuthState","props","initialState","token","localStorage","getItem","autenticado","usuario","mensaje","cargando","state","dispatch","registrarUsuario","datos","post","respuesta","console","log","data","type","payload","obtenerUsuario","alerta","msg","response","categoria","get","iniciarSesion","cerrarSesion","children"],"mappings":"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","sourcesContent":["import React, { useReducer } from 'react';\nimport authContext from './authContext'\nimport authReducer from './authReducer'\nimport clienteAxios from '../../config/axios'\nimport tokenAuth from '../../config/token'\n\n// eslint-disable-next-line\nimport {\n  REGISTRO_EXITOSO,\n  REGISTRO_ERROR,\n  OBTENER_USUARIO,\n  LOGIN_EXITOSO,\n  LOGIN_ERROR,\n  CERRAR_SESION\n} from '../../types'\n\nconst AuthState = props => {\n  \n    const initialState = {\n        token: localStorage.getItem('token'),\n        autenticado: null,\n        usuario: null,\n        mensaje: null,\n        cargando: true\n          \n    } \n    \n    const [ state, dispatch ] = useReducer(authReducer, initialState)\n    \n    // FUNCIONES\n    // REGISTRO de usuario\n    const registrarUsuario = async datos => {\n        \n        try {\n              const respuesta = await clienteAxios.post('/api/usuarios', datos)\n              console.log(respuesta.data)\n              \n              dispatch({\n                  type: REGISTRO_EXITOSO,\n                  payload: respuesta.data\n              })\n              \n              // al registrarse OBTENERMOS EL USUARIO\n              obtenerUsuario()\n            \n        } catch (error) {\n              //console.log(error.response.data.msg)\n              const alerta = {\n                  msg: error.response.data.msg,\n                  categoria: 'alerta-error'\n              }\n              dispatch({\n                  type: REGISTRO_ERROR,\n                  payload: alerta              \n              })\n        }\n    }\n    \n    // OBTENER USUARIO autenticado\n    const obtenerUsuario = async () => {\n        // obtenemos el token del localStorage colocado por REGISTRO_EXITOSO\n        const token = localStorage.getItem('token')\n        \n        if(token) {\n            tokenAuth(token)\n        }\n        \n        try {\n              const respuesta = await clienteAxios.get('/api/auth')\n              //console.log(respuesta.data)\n              dispatch({\n                  type: OBTENER_USUARIO,\n                  payload: respuesta.data.usuario\n              })\n            \n        } catch (error) {\n              console.log(error.response)\n              dispatch({\n                  type: LOGIN_ERROR\n              })\n        }      \n    }\n    \n    // INICIO DE SESIÓN\n    const iniciarSesion = async datos => {\n        try {\n              const respuesta = await clienteAxios.post('/api/auth', datos)\n              //console.log(respuesta)\n              dispatch({\n                  type: LOGIN_EXITOSO,\n                  payload: respuesta.data // pasa el token \n              })\n              // al iniciar sesión OBTENERMOS EL USUARIO\n              obtenerUsuario()\n        } catch (error) {\n              console.log(error.response.data.msg)\n              const alerta = {\n                msg: error.response.data.msg,\n                categoria: 'alerta-error'\n              }\n              dispatch({\n                  type: LOGIN_ERROR,\n                  payload: alerta              \n              }) \n        }\n    }\n    \n    // CERRAR SESIÓN\n    const cerrarSesion = () => {\n        dispatch({\n            type: CERRAR_SESION\n        })\n    }\n    \n    \n  \n    return(\n        <authContext.Provider\n            value={{\n                token: state.token,\n                autenticado: state.autenticado,\n                usuario: state.usuario,\n                mensaje: state.mensaje,\n                cargando: state.cargando,\n                registrarUsuario,\n                iniciarSesion,\n                obtenerUsuario,\n                cerrarSesion\n            }}\n        >\n            {props.children}\n        </authContext.Provider>\n    )\n  \n}\n\nexport default AuthState;"]},"metadata":{},"sourceType":"module"}